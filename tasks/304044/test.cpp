#include <gtest/gtest.h>
#include <vector>
#include "solution.cpp"

using namespace std;

TEST(PermutationFactoryTest, HandlesTestCases) {
    // Test case 1
    vector<vector<int>> p_s = {
        {2, 1},
        {1, 2, 3},
        {2, 1, 4, 3},
        {1, 4, 3, 2, 5},
        {2, 3, 1, 4, 5},
        {2, 1, 3, 5, 4},
        {5, 3, 1, 2, 4},
        {3, 1, 5, 4, 2},
        {5, 4, 1, 2, 3},
        {5, 4, 3, 1, 2},
        {1, 5, 4, 2, 3},
        {3, 5, 2, 1, 4},
        {5, 3, 1, 2, 4},
        {4, 3, 5, 2, 1},
        {4, 2, 1, 3},
        {5, 3, 4, 2, 1},
        {2, 4, 5, 3, 1},
        {5, 3, 2, 4, 1},
        {1, 4, 2, 3, 5},
        {2, 4, 5, 1, 3},
        {3, 4, 2, 1, 5},
        {3, 5, 1, 2, 4},
        {4, 3, 5, 1, 2},
        {4, 2, 1, 5, 3}
    };
    
    vector<vector<int>> q_s = {
        {2, 1},
        {3, 2, 1},
        {4, 2, 3, 1},
        {5, 2, 3, 4, 1},
        {4, 5, 2, 3, 1},
        {5, 4, 2, 3, 1},
        {3, 2, 4, 1, 5},
        {4, 5, 2, 3, 1},
        {1, 5, 4, 2, 3},
        {1, 5, 4, 3, 2},
        {2, 3, 4, 5, 1},
        {3, 5, 4, 2, 1},
        {1, 4, 5, 3, 2},
        {4, 5, 2, 3, 1},
        {2, 3, 4, 1},
        {5, 3, 2, 4, 1},
        {3, 1, 2, 4, 5},
        {4, 3, 1, 2, 5},
        {4, 1, 5, 2, 3},
        {2, 4, 1, 3, 5},
        {1, 5, 2, 4, 3},
        {3, 4, 2, 5, 1},
        {1, 5, 4, 2, 3},
        {3, 2, 1, 4, 5}
    };
    
    vector<vector<pair<int, int>>> expected = {
        {},
        {{1, 3}},
        {{1, 4}, {2, 4}, {1, 3}},
        {{1, 2}, {4, 5}, {2, 5}, {1, 4}},
        {{2, 4}, {2, 5}, {1, 5}, {3, 5}},
        {{1,3}, {1, 5}, {2, 5}, {1, 4}, {2, 4}},
        {{1, 2}, {3, 4}, {2, 3}, {5,3}},
        {{2, 3}, {3, 5},{1, 4}},
        {{2, 3}, {1, 2}},
        {{3, 4}, {2, 3}, {1, 2}},
        {{4, 5}, {1, 5}, {4, 2}},
        {{4, 5}, {3, 4}},
        {{1, 3}, {2, 5}, {4, 5}},
        {{2, 3}, {3, 4}},
        {{1, 2}, {3, 4}, {3, 2}},
        {{3, 4}},
        {{3, 5}, {4, 2}, {1, 2}, {3, 2}},
        {{4, 5}, {4, 3}, {5, 1}},
        {{1, 2}, {4, 5}, {3, 4}},
        {{3, 4}, {4, 5}},
        {{4, 5}, {5, 1},  {2, 4}},
        {{4, 5}, {3, 5}, {4, 2}},
        {{1, 2}, {2, 3}, {5, 1}, {4, 1}},
        {{5, 1}, {5, 4}}
    };
    
    vector<vector<pair<int, int>>> result = solveAll(p_s, q_s);
    
    ASSERT_EQ(result.size(), expected.size());
    
    for (size_t i = 0; i < result.size(); ++i) {
        ASSERT_EQ(result[i].size(), expected[i].size()) << "Mismatch in number of operations for test case " << i + 1;
        for (size_t j = 0; j < result[i].size(); ++j) {
            auto first = result[i][j].first; 
            auto second = result[i][j].second; 
            swap(p_s[i][first-1], p_s[i][second-1]);
        }
        EXPECT_EQ(p_s[i], q_s[i]);
    }
}